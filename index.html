<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>é‡‘èæƒ…æŠ¥æ´å¯Ÿå¹³å°</title>
    <link rel="stylesheet" href="assets/styles.cee14c78.css">
</head>
<body>
    <!-- æ»šåŠ¨è¿›åº¦æŒ‡ç¤ºå™¨ -->
    <div class="scroll-progress-container">
        <div class="scroll-progress-bar" id="scroll-progress-bar"></div>
    </div>
    
    <!-- ç¦»çº¿çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div class="offline-indicator" id="offline-indicator">
        ç½‘ç»œè¿æ¥å·²æ–­å¼€ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™
    </div>
    
    <!-- å¯¼èˆªæ¨ªå¹…ï¼šè·³è½¬åˆ°ä»Šæ—¥æ´å¯ŸæŠ¥å‘Š -->
    <div class="navigation-banner" style="
        position: sticky;
        top: 0;
        z-index: 1000;
        background: rgba(26, 60, 139, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        padding: 12px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    ">
        <div style="
            font-size: 18px;
            font-weight: 600;
            color: white;
            letter-spacing: 0.5px;
        ">
            é‡‘èæƒ…æŠ¥æ´å¯Ÿå¹³å°
        </div>
        <a href="history/2026-02-10/index.html" style="
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            text-decoration: none;
            padding: 10px 24px;
            border-radius: 24px;
            font-weight: 600;
            font-size: 14px;
            letter-spacing: 0.3px;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: inline-block;
        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(76, 175, 80, 0.4)';" 
           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(76, 175, 80, 0.3)';">
            æŸ¥çœ‹ä»Šæ—¥æ´å¯ŸæŠ¥å‘Š
        </a>
    </div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- å¯¼èˆªæ ç»„ä»¶å®¹å™¨ -->
        <div id="navigation-container"></div>
        
        <!-- å®æ—¶æ›´æ–°æ§åˆ¶é¢æ¿ -->
        <div id="realtime-control-panel" class="realtime-control-panel">
            <div class="control-header">
                <h3><i class="icon-refresh"></i> å®æ—¶æ›´æ–°å¼•æ“</h3>
                <div class="status-indicators">
                    <span class="status-badge network-status" id="network-status">åœ¨çº¿</span>
                    <span class="status-badge engine-status" id="engine-status">å¾…æœº</span>
                </div>
            </div>
            
            <div class="control-body">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">è½®è¯¢æ¬¡æ•°</div>
                        <div class="stat-value" id="polling-count">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">æˆåŠŸæ›´æ–°</div>
                        <div class="stat-value" id="update-success">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">å¤±è´¥æ¬¡æ•°</div>
                        <div class="stat-value" id="update-failures">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">å¹³å‡å»¶è¿Ÿ</div>
                        <div class="stat-value" id="avg-latency">0ms</div>
                    </div>
                </div>
                
                <div class="control-buttons">
                    <button id="toggle-polling" class="btn btn-primary">å¯åŠ¨è½®è¯¢</button>
                    <button id="manual-refresh" class="btn btn-secondary">æ‰‹åŠ¨åˆ·æ–°</button>
                    <button id="toggle-demo" class="btn btn-info">æ¼”ç¤ºæ¨¡å¼</button>
                    <button id="reset-stats" class="btn btn-warning">é‡ç½®ç»Ÿè®¡</button>
                </div>
                
                <div class="update-log">
                    <div class="log-header">
                        <h4>æ›´æ–°æ—¥å¿—</h4>
                        <button id="clear-log" class="btn btn-sm btn-outline">æ¸…ç©º</button>
                    </div>
                    <div class="log-content" id="update-log">
                        <div class="log-entry log-info">å®æ—¶æ›´æ–°å¼•æ“å·²åˆå§‹åŒ–</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- æ´å¯Ÿåˆ—è¡¨å®¹å™¨ -->
            <div id="insights-container">
                <div class="loading-shimmer" style="height: 300px; border-radius: var(--radius-md); margin-bottom: var(--space-md);"></div>
                <div class="loading-shimmer" style="height: 300px; border-radius: var(--radius-md); margin-bottom: var(--space-md);"></div>
            </div>
            
            <!-- å½±å“çŸ©é˜µå®¹å™¨ -->
            <div id="impact-matrix-container"></div>
            
            <!-- å†å²æŠ¥å‘Šå®¹å™¨ -->
            <div id="history-container" style="display: none;">
                <h2>å†å²æŠ¥å‘Š</h2>
                <div id="history-list" class="history-list">
                    <!-- åŠ¨æ€ç”Ÿæˆå†å²æŠ¥å‘Šåˆ—è¡¨ -->
                </div>
            </div>
        </main>
    </div>
    
    <!-- ç»„ä»¶è„šæœ¬ -->
    <script src="components/NavigationBar.js"></script>
    <script src="components/RealTimeFeedEngine.js"></script>
    <script src="components/InsightCard.js"></script>
    <script src="components/ImpactMatrix.js"></script>
    <script src="components/ServiceWorker.js"></script>
    <script src="components/PWAManager.js"></script>
    <script src="components/ComponentManager.js"></script>
    <script src="components/LazyLoader.js"></script>
    <script src="components/WebVitalsMonitor.js"></script>
    <script src="components/PerformanceOptimizer.js"></script>
    <script src="realtime/PollingService.js"></script>
    <script src="realtime/ChangeDetector.js"></script>
    <script src="realtime/IncrementalRenderer.js"></script>
    <script src="realtime/CacheManager.js"></script>
    <script src="realtime/RealTimeState.js"></script>
    <script src="realtime/PerformanceMonitor.js"></script>
    <script src="realtime/RealTimeEngine.js"></script>
    
    <!-- åˆå§‹åŒ–è„šæœ¬ -->
    <script>
        // ç­‰å¾…DOMåŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–ç»„ä»¶ç®¡ç†å™¨
            const componentManager = new ComponentManager({
                components: {
                    navigationBar: {
                        type: 'NavigationBar',
                        container: 'navigation-container',
                        options: {
                            activeTab: 'daily',
                            userPreferences: {
                                theme: 'dark'
                            },
                            onTabChange: (tabName) => {
                                console.log('Tabåˆ‡æ¢:', tabName);
                                handleTabChange(tabName);
                            },
                            onSearch: (query) => {
                                console.log('æœç´¢:', query);
                                handleSearch(query);
                            }
                        }
                    },
                    realTimeFeedEngine: {
                        type: 'RealTimeFeedEngine',
                        container: 'insights-container',
                        options: {
                            apiEndpoint: '/api/insights/latest',
                            pollingConfig: {
                                normalInterval: 30000,
                                activeInterval: 10000,
                                backgroundInterval: 60000
                            },
                            onDataUpdate: (changes, newData) => {
                                console.log('æ•°æ®æ›´æ–°:', changes);
                                handleDataUpdate(changes, newData);
                            },
                            renderFunction: (changes, newData) => {
                                return renderInsights(changes, newData);
                            }
                        }
                    },
                    impactMatrix: {
                        type: 'ImpactMatrix',
                        container: 'impact-matrix-container',
                        options: {
                            onItemClick: (item) => {
                                console.log('çŸ©é˜µé¡¹ç›®ç‚¹å‡»:', item);
                                handleMatrixItemClick(item);
                            }
                        }
                    },
                    pwaManager: {
                        type: 'PWAManager',
                        options: {
                            serviceWorkerPath: '/service-worker.js',
                            manifest: {
                                name: 'é‡‘èæƒ…æŠ¥æ´å¯Ÿå¹³å°',
                                short_name: 'é‡‘èæƒ…æŠ¥',
                                description: 'ä¸“ä¸šçš„é‡‘èæƒ…æŠ¥æ´å¯Ÿä¸åˆ†æå¹³å°',
                                theme_color: '#1a3c8b',
                                background_color: '#0a1e3c',
                                display: 'standalone',
                                orientation: 'portrait',
                                icons: [
                                    {
                                        src: 'assets/icons/icon-192x192.png',
                                        sizes: '192x192',
                                        type: 'image/png'
                                    },
                                    {
                                        src: 'assets/icons/icon-512x512.png',
                                        sizes: '512x512',
                                        type: 'image/png'
                                    }
                                ]
                            },
                            onUpdateAvailable: (newWorker) => {
                                console.log('æ›´æ–°å¯ç”¨:', newWorker);
                                handleUpdateAvailable(newWorker);
                            },
                            onOfflineStatusChange: (isOnline) => {
                                console.log('ç¦»çº¿çŠ¶æ€å˜åŒ–:', isOnline);
                                handleOfflineStatusChange(isOnline);
                            }
                        }
                    },
                    performanceOptimizer: {
                        type: 'PerformanceOptimizer',
                        options: {
                            lazyLoading: {
                                enable: true,
                                rootMargin: '200px',
                                threshold: 0.01
                            },
                            webVitals: {
                                enable: true,
                                autoReportToConsole: true,
                                thresholds: {
                                    lcp: { good: 2500, poor: 4000 },
                                    fid: { good: 100, poor: 300 },
                                    cls: { good: 0.1, poor: 0.25 },
                                    fcp: { good: 1000, poor: 3000 },
                                    ttfb: { good: 800, poor: 1800 }
                                }
                            },
                            cache: {
                                enableServiceWorker: true,
                                enableMemoryCache: true
                            },
                            onOptimizationComplete: (result) => {
                                console.log('æ€§èƒ½ä¼˜åŒ–å®Œæˆ:', result);
                            },
                            onError: (error) => {
                                console.error('æ€§èƒ½ä¼˜åŒ–é”™è¯¯:', error);
                            }
                        }
                    }
                },
                state: {
                    currentTab: 'daily',
                    isOnline: navigator.onLine,
                    lastUpdateTime: null
                },
                onStateChange: (componentName, state) => {
                    console.log('çŠ¶æ€å˜åŒ–:', componentName, state);
                    handleGlobalStateChange(componentName, state);
                }
            });
            
            // åˆå§‹åŒ–æ»šåŠ¨è¿›åº¦æŒ‡ç¤ºå™¨
            // åˆå§‹åŒ–å®æ—¶æ›´æ–°å¼•æ“
            const realtimeEngine = new RealTimeEngine({
                apiEndpoint: "/api/insights/latest",
                pollingConfig: {
                    normalInterval: 30000,
                    activeInterval: 10000,
                    backgroundInterval: 60000,
                    retryDelay: 5000,
                    maxRetries: 3
                },
                onDataUpdate: (changes, newData) => {
                    console.log("å®æ—¶æ•°æ®æ›´æ–°:", changes);
                    handleDataUpdate(changes, newData);
                },
                enableCache: true,
                enablePerformanceMonitor: true
            });

            // å¯åŠ¨å®æ—¶æ›´æ–°å¼•æ“
            realtimeEngine.start();

            initScrollProgressIndicator();
            
            // æ˜¾ç¤ºåˆå§‹åŠ è½½çŠ¶æ€
            setTimeout(() => {
                const loadingElements = document.querySelectorAll('.loading-shimmer');
                loadingElements.forEach(el => {
                    el.style.opacity = '0.5';
                });
            }, 1000);
        });
        
        // ====== äº‹ä»¶å¤„ç†å‡½æ•° ======
        
        /**
         * å¤„ç†Tabåˆ‡æ¢
         */
        function handleTabChange(tabName) {
            switch (tabName) {
                case 'daily':
                    showDailyInsights();
                    break;
                case 'weekly':
                    showWeeklySummary();
                    break;
                default:
                    console.warn('æœªçŸ¥Tab:', tabName);
            }
        }
        
        /**
         * å¤„ç†æœç´¢
         */
        function handleSearch(query) {
            // æœç´¢é€»è¾‘
            console.log('æ‰§è¡Œæœç´¢:', query);
        }
        
        /**
         * å¤„ç†æ•°æ®æ›´æ–°
         */
        function handleDataUpdate(changes, newData) {
            // æ ¹æ®å˜åŒ–ç±»å‹æ›´æ–°UI
            if (changes.hasChanges) {
                console.log('æ£€æµ‹åˆ°æ•°æ®å˜åŒ–:', changes);
            }
        }
        
        /**
         * å¤„ç†çŸ©é˜µé¡¹ç›®ç‚¹å‡»
         */
        function handleMatrixItemClick(item) {
            // è·³è½¬åˆ°å¯¹åº”æ´å¯Ÿ
            const insightId = item.id;
            const insightElement = document.querySelector(`[data-insight-id="${insightId}"]`);
            
            if (insightElement) {
                insightElement.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
                
                // æ·»åŠ é«˜äº®æ•ˆæœ
                insightElement.classList.add('highlighted');
                setTimeout(() => {
                    insightElement.classList.remove('highlighted');
                }, 2000);
            }
        }
        
        /**
         * å¤„ç†æ›´æ–°å¯ç”¨
         */
        function handleUpdateAvailable(newWorker) {
            // æ˜¾ç¤ºæ›´æ–°æç¤º
            showUpdateNotification();
        }
        
        /**
         * å¤„ç†ç¦»çº¿çŠ¶æ€å˜åŒ–
         */
        function handleOfflineStatusChange(isOnline) {
            const indicator = document.getElementById('offline-indicator');
            
            if (isOnline) {
                indicator.classList.remove('visible');
            } else {
                indicator.classList.add('visible');
            }
        }
        
        /**
         * å¤„ç†å…¨å±€çŠ¶æ€å˜åŒ–
         */
        function handleGlobalStateChange(componentName, state) {
            // æ ¹æ®ç»„ä»¶å’ŒçŠ¶æ€æ›´æ–°å…¶ä»–ç»„ä»¶
            console.log('å…¨å±€çŠ¶æ€å˜åŒ–:', componentName, state);
        }
        
        // ====== UIæ§åˆ¶å‡½æ•° ======
        
        /**
         * æ˜¾ç¤ºæ¯æ—¥æ´å¯Ÿ
         */
        function showDailyInsights() {
            const insightsContainer = document.getElementById('insights-container');
            const historyContainer = document.getElementById('history-container');
            
            insightsContainer.style.display = 'block';
            historyContainer.style.display = 'none';
        }
        
        /**
         * æ˜¾ç¤ºæ¯å‘¨æ€»ç»“
         */
        function showWeeklySummary() {
            const insightsContainer = document.getElementById('insights-container');
            const historyContainer = document.getElementById('history-container');
            
            insightsContainer.style.display = 'none';
            historyContainer.style.display = 'block';
        }
        
        /**
         * æ˜¾ç¤ºæ›´æ–°é€šçŸ¥
         */
        function showUpdateNotification() {
            const notification = document.createElement('div');
            notification.className = 'update-notification';
            notification.innerHTML = `
                <div style="background: rgba(0,0,0,0.9); color: white; padding: 12px 16px; border-radius: 12px; max-width: 300px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <span style="font-size: 20px;">ğŸ”„</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 14px;">æ–°ç‰ˆæœ¬å¯ç”¨</div>
                            <div style="font-size: 12px; opacity: 0.8;">ç‚¹å‡»åˆ·æ–°é¡µé¢ä»¥åº”ç”¨æ›´æ–°</div>
                        </div>
                        <button onclick="applyUpdate()" style="background: #007aff; color: white; border: none; padding: 6px 12px; border-radius: 8px; font-size: 13px; font-weight: 500; cursor: pointer;">åˆ·æ–°</button>
                    </div>
                </div>
            `;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(notification);
        }
        
        /**
         * åº”ç”¨æ›´æ–°
         */
        function applyUpdate() {
            window.location.reload();
        }
        
        /**
         * åˆå§‹åŒ–æ»šåŠ¨è¿›åº¦æŒ‡ç¤ºå™¨
         */
        function initScrollProgressIndicator() {
            const scrollProgressBar = document.getElementById('scroll-progress-bar');
            
            window.addEventListener('scroll', () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrollPercent = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
                
                scrollProgressBar.style.width = scrollPercent + '%';
            });
        }
        
        /**
         * æ¸²æŸ“æ´å¯Ÿ
         */
        function renderInsights(changes, newData) {
            // è¿™é‡Œå°†è°ƒç”¨InsightCardç»„ä»¶æ¥æ¸²æŸ“æ´å¯Ÿåˆ—è¡¨
            const insightsContainer = document.getElementById('insights-container');
            
            // å®é™…æ¸²æŸ“é€»è¾‘å°†åœ¨ç»„ä»¶ä¸­å®ç°
            console.log('æ¸²æŸ“æ´å¯Ÿ:', newData);
            
            return Promise.resolve();
        }
    </script>
</body>
</html>